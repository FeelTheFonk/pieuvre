// Pieuvre â€” Vue Dashboard
//
// Vue d'ensemble systÃ¨me avec cards.

import { Tokens } from "../tokens.slint";
import { SystemInfo, AppState } from "../globals.slint";
import { StatusBadge, BadgeVariant } from "../components/status_badge.slint";
import { PrimaryButton, SecondaryButton } from "../components/button.slint";

// Card gÃ©nÃ©rique
component InfoCard inherits Rectangle {
    in property <string> title: "Card";
    in property <string> icon: "ðŸ“Š";
    
    background: Tokens.surface-color;
    border-radius: Tokens.radius-lg;
    
    VerticalLayout {
        padding: Tokens.spacing-md;
        spacing: Tokens.spacing-sm;
        
        // Header
        HorizontalLayout {
            spacing: Tokens.spacing-sm;
            
            Text {
                text: icon;
                font-size: Tokens.font-size-lg;
                vertical-alignment: center;
            }
            
            Text {
                text: title;
                color: Tokens.text-primary;
                font-size: Tokens.font-size-md;
                font-weight: 600;
                vertical-alignment: center;
            }
        }
        
        // Content slot
        @children
    }
}

// Ligne info key-value
component InfoRow inherits Rectangle {
    in property <string> label: "Label";
    in property <string> value: "Value";
    
    height: 28px;
    background: transparent;
    
    HorizontalLayout {
        alignment: space-between;
        
        Text {
            text: label;
            color: Tokens.text-secondary;
            font-size: Tokens.font-size-sm;
            vertical-alignment: center;
        }
        
        Text {
            text: value;
            color: Tokens.text-primary;
            font-size: Tokens.font-size-sm;
            font-weight: 500;
            vertical-alignment: center;
        }
    }
}

export component DashboardView inherits Rectangle {
    callback run-audit;
    callback open-optimizations;
    
    // System info passed from MainWindow
    in property <string> os-version: "Windows 11";
    in property <string> build-number: "22631";
    in property <string> hostname: "DESKTOP";
    in property <string> cpu-name: "Unknown CPU";
    in property <int> cpu-cores: 8;
    in property <int> ram-gb: 16;
    in property <string> gpu-name: "Unknown GPU";
    in property <bool> is-laptop: false;
    
    // Telemetry state
    in property <bool> telemetry-diagtrack: true;
    in property <int> telemetry-level: 3;
    
    // Performance state
    in property <string> timer-resolution: "15.6ms";
    in property <string> power-plan: "Balanced";
    in property <bool> msi-mode: false;
    
    background: Tokens.background-color;
    
    Flickable {
        viewport-height: content.preferred-height;
        
        content := VerticalLayout {
            padding: Tokens.spacing-lg;
            spacing: Tokens.spacing-lg;
            
            // Quick actions
            HorizontalLayout {
                spacing: Tokens.spacing-md;
                
                PrimaryButton {
                    label: "â–¶ Lancer Audit";
                    clicked => { run-audit(); }
                }
                
                SecondaryButton {
                    label: "âš¡ Optimiser";
                    clicked => { open-optimizations(); }
                }
            }
            
            // Cards grid
            HorizontalLayout {
                spacing: Tokens.spacing-lg;
                
                // System card
                InfoCard {
                    title: "Systeme";
                    icon: ">";
                    horizontal-stretch: 1;
                    
                    VerticalLayout {
                        spacing: Tokens.spacing-xs;
                        
                        InfoRow {
                            label: "OS";
                            value: root.os-version;
                        }
                        
                        InfoRow {
                            label: "Build";
                            value: root.build-number;
                        }
                        
                        InfoRow {
                            label: "Hostname";
                            value: root.hostname;
                        }
                    }
                }
                
                // Hardware card
                InfoCard {
                    title: "Materiel";
                    icon: "<";
                    horizontal-stretch: 1;
                    
                    VerticalLayout {
                        spacing: Tokens.spacing-xs;
                        
                        InfoRow {
                            label: "CPU";
                            value: root.cpu-name;
                        }
                        
                        InfoRow {
                            label: "Coeurs";
                            value: root.cpu-cores + "";
                        }
                        
                        InfoRow {
                            label: "RAM";
                            value: root.ram-gb + " GB";
                        }
                        
                        InfoRow {
                            label: "GPU";
                            value: root.gpu-name;
                        }
                    }
                }
            }
            
            HorizontalLayout {
                spacing: Tokens.spacing-lg;
                
                // Telemetry card
                InfoCard {
                    title: "Telemetrie";
                    icon: ">";
                    horizontal-stretch: 1;
                    
                    VerticalLayout {
                        spacing: Tokens.spacing-sm;
                        
                        HorizontalLayout {
                            alignment: space-between;
                            
                            Text {
                                text: "DiagTrack";
                                color: Tokens.text-secondary;
                                font-size: Tokens.font-size-sm;
                                vertical-alignment: center;
                            }
                            
                            StatusBadge {
                                label: root.telemetry-diagtrack ? "Actif" : "Inactif";
                                variant: root.telemetry-diagtrack ? BadgeVariant.warning : BadgeVariant.success;
                            }
                        }
                        
                        InfoRow {
                            label: "Niveau collection";
                            value: root.telemetry-level == 0 ? "Off" :
                                   root.telemetry-level == 1 ? "Basic" :
                                   root.telemetry-level == 2 ? "Enhanced" : "Full";
                        }
                    }
                }
                
                // Performance card
                InfoCard {
                    title: "Performance";
                    icon: "<";
                    horizontal-stretch: 1;
                    
                    VerticalLayout {
                        spacing: Tokens.spacing-xs;
                        
                        InfoRow {
                            label: "Timer Resolution";
                            value: root.timer-resolution;
                        }
                        
                        InfoRow {
                            label: "Power Plan";
                            value: root.power-plan;
                        }
                        
                        InfoRow {
                            label: "MSI Mode";
                            value: root.msi-mode ? "Actif" : "Non detecte";
                        }
                    }
                }
            }
            
            // Health summary card
            InfoCard {
                title: "SantÃ© Optimisations";
                icon: "â¤";
                
                VerticalLayout {
                    spacing: Tokens.spacing-md;
                    
                    HorizontalLayout {
                        spacing: Tokens.spacing-lg;
                        
                        VerticalLayout {
                            spacing: Tokens.spacing-xs;
                            
                            Text {
                                text: "0";
                                color: Tokens.success-color;
                                font-size: Tokens.font-size-2xl;
                                font-weight: 700;
                            }
                            
                            Text {
                                text: "AppliquÃ©es";
                                color: Tokens.text-secondary;
                                font-size: Tokens.font-size-sm;
                            }
                        }
                        
                        VerticalLayout {
                            spacing: Tokens.spacing-xs;
                            
                            Text {
                                text: "45";
                                color: Tokens.warning-color;
                                font-size: Tokens.font-size-2xl;
                                font-weight: 700;
                            }
                            
                            Text {
                                text: "RecommandÃ©es";
                                color: Tokens.text-secondary;
                                font-size: Tokens.font-size-sm;
                            }
                        }
                        
                        VerticalLayout {
                            spacing: Tokens.spacing-xs;
                            
                            Text {
                                text: "0";
                                color: Tokens.text-secondary;
                                font-size: Tokens.font-size-2xl;
                                font-weight: 700;
                            }
                            
                            Text {
                                text: "Snapshots";
                                color: Tokens.text-secondary;
                                font-size: Tokens.font-size-sm;
                            }
                        }
                    }
                }
            }
        }
    }
}
